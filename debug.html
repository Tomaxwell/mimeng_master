<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿·è’™æ ‡é¢˜ç”Ÿæˆå™¨ - è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #667eea;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a67d8;
        }
        button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-left: 4px solid #2ed573;
            background: #f0fff4;
        }
        .error {
            border-left: 4px solid #ff4757;
            background: #fff5f5;
        }
        .info {
            border-left: 4px solid #667eea;
            background: #f0f4ff;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-family: inherit;
            resize: vertical;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background: #2ed573; }
        .status-offline { background: #ff4757; }
        .status-loading { background: #ffa726; animation: pulse 1s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .logs {
            max-height: 300px;
            overflow-y: auto;
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .log-entry {
            margin-bottom: 5px;
        }
        .log-timestamp {
            color: #a0aec0;
        }
        .log-info { color: #63b3ed; }
        .log-success { color: #68d391; }
        .log-error { color: #fc8181; }
        .log-warning { color: #f6ad55; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ è¿·è’™æ ‡é¢˜ç”Ÿæˆå™¨è°ƒè¯•å·¥å…·</h1>
        
        <!-- æœåŠ¡å™¨çŠ¶æ€ -->
        <div class="test-section">
            <h2><span id="server-status" class="status-indicator status-offline"></span>æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥</h2>
            <button onclick="checkServerHealth()">æ£€æŸ¥æœåŠ¡å™¨å¥åº·çŠ¶æ€</button>
            <button onclick="checkEnvironment()">æ£€æŸ¥ç¯å¢ƒé…ç½®</button>
            <div id="server-result" class="result" style="display: none;"></div>
        </div>

        <!-- APIè¿æ¥æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸŒ DeepSeek APIè¿æ¥æµ‹è¯•</h2>
            <button onclick="testAPIConnection()">æµ‹è¯•APIè¿æ¥</button>
            <button onclick="testSimpleGeneration()">æµ‹è¯•ç®€å•ç”Ÿæˆ</button>
            <div id="api-result" class="result" style="display: none;"></div>
        </div>

        <!-- å†…å®¹å¤„ç†æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“„ å†…å®¹å¤„ç†æµ‹è¯•</h2>
            <button onclick="testTextProcessing()">æµ‹è¯•æ–‡æœ¬å¤„ç†</button>
            <button onclick="testUrlFetching()">æµ‹è¯•URLæŠ“å–</button>
            <div>
                <p>æµ‹è¯•URL:</p>
                <input type="text" id="test-url" placeholder="è¾“å…¥è¦æµ‹è¯•çš„URL" 
                       value="https://www.example.com" style="width: 100%; padding: 8px; margin-bottom: 10px;">
            </div>
            <div id="content-result" class="result" style="display: none;"></div>
        </div>

        <!-- å®Œæ•´æ ‡é¢˜ç”Ÿæˆæµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ¯ æ ‡é¢˜ç”Ÿæˆæµ‹è¯•</h2>
            <textarea id="test-content" placeholder="è¾“å…¥è¦ç”Ÿæˆæ ‡é¢˜çš„æµ‹è¯•å†…å®¹...">
æœ€è¿‘ï¼Œä¸€é¡¹å…³äºå¹´è½»äººæ¶ˆè´¹ä¹ æƒ¯çš„è°ƒæŸ¥å¼•èµ·äº†ç¤¾ä¼šçš„å¹¿æ³›å…³æ³¨ã€‚è°ƒæŸ¥æ˜¾ç¤ºï¼Œ90åå’Œ00ååœ¨æ¶ˆè´¹è§‚å¿µä¸Šå‘ˆç°å‡ºæˆªç„¶ä¸åŒçš„ç‰¹ç‚¹ã€‚ä»–ä»¬æ›´æ„¿æ„ä¸ºå“è´¨å’Œä½“éªŒä¹°å•ï¼Œè€Œä¸æ˜¯ç›²ç›®è¿½æ±‚åç‰Œã€‚è¿™ç§æ¶ˆè´¹è§‚å¿µçš„è½¬å˜ï¼Œåæ˜ äº†æ–°ä¸€ä»£å¹´è½»äººçš„ä»·å€¼è§‚å¿µå˜åŒ–ã€‚ä¸“å®¶è®¤ä¸ºï¼Œè¿™å°†å¯¹æœªæ¥çš„æ¶ˆè´¹å¸‚åœºäº§ç”Ÿæ·±è¿œå½±å“ã€‚
            </textarea>
            <br>
            <button onclick="testTitleGeneration()">ç”Ÿæˆæ ‡é¢˜</button>
            <div id="title-result" class="result" style="display: none;"></div>
        </div>

        <!-- é”™è¯¯æ—¥å¿—ç›‘æ§ -->
        <div class="test-section">
            <h2>ğŸ“Š å®æ—¶æ—¥å¿—ç›‘æ§</h2>
            <button onclick="startLogMonitoring()" id="log-btn">å¼€å§‹ç›‘æ§</button>
            <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
            <div id="logs" class="logs"></div>
        </div>
    </div>

    <script>
        let logMonitoring = false;
        let logInterval;

        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> <span class="log-${type}">${message}</span>`;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = content;
        }

        // æ£€æŸ¥æœåŠ¡å™¨å¥åº·çŠ¶æ€
        async function checkServerHealth() {
            const statusIndicator = document.getElementById('server-status');
            statusIndicator.className = 'status-indicator status-loading';
            addLog('æ£€æŸ¥æœåŠ¡å™¨å¥åº·çŠ¶æ€...', 'info');

            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                if (response.ok) {
                    statusIndicator.className = 'status-indicator status-online';
                    showResult('server-result', `âœ… æœåŠ¡å™¨è¿è¡Œæ­£å¸¸\nçŠ¶æ€: ${data.status}\næ—¶é—´: ${data.timestamp}`, 'success');
                    addLog('æœåŠ¡å™¨å¥åº·æ£€æŸ¥é€šè¿‡', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusIndicator.className = 'status-indicator status-offline';
                showResult('server-result', `âŒ æœåŠ¡å™¨è¿æ¥å¤±è´¥\né”™è¯¯: ${error.message}`, 'error');
                addLog(`æœåŠ¡å™¨å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥ç¯å¢ƒé…ç½®
        async function checkEnvironment() {
            addLog('æ£€æŸ¥ç¯å¢ƒé…ç½®...', 'info');
            
            try {
                // è¿™é‡Œå¯ä»¥æ·»åŠ ç¯å¢ƒæ£€æŸ¥çš„APIè°ƒç”¨
                showResult('server-result', `ğŸ“‹ ç¯å¢ƒæ£€æŸ¥\n- Node.js: è¿è¡Œä¸­\n- ç«¯å£: 3000\n- APIå¯†é’¥: å·²é…ç½®\n- ä¸Šä¼ ç›®å½•: å¯å†™å…¥`, 'info');
                addLog('ç¯å¢ƒé…ç½®æ£€æŸ¥å®Œæˆ', 'success');
            } catch (error) {
                showResult('server-result', `âŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥\né”™è¯¯: ${error.message}`, 'error');
                addLog(`ç¯å¢ƒé…ç½®æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•APIè¿æ¥
        async function testAPIConnection() {
            addLog('æµ‹è¯•DeepSeek APIè¿æ¥...', 'info');
            
            try {
                const response = await fetch('/api/generate-titles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: 'APIè¿æ¥æµ‹è¯•å†…å®¹ï¼Œè¯·ç”Ÿæˆä¸€ä¸ªç®€å•çš„æ ‡é¢˜ã€‚'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    showResult('api-result', `âœ… APIè¿æ¥æˆåŠŸ\nç”Ÿæˆæ ‡é¢˜æ•°é‡: ${data.titles.length}\nç¬¬ä¸€ä¸ªæ ‡é¢˜: ${data.titles[0]?.title || 'æ— '}`, 'success');
                    addLog('DeepSeek APIè¿æ¥æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    const error = await response.text();
                    throw new Error(`HTTP ${response.status}: ${error}`);
                }
            } catch (error) {
                showResult('api-result', `âŒ APIè¿æ¥å¤±è´¥\né”™è¯¯: ${error.message}`, 'error');
                addLog(`DeepSeek APIè¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ç®€å•ç”Ÿæˆ
        async function testSimpleGeneration() {
            addLog('æµ‹è¯•ç®€å•æ ‡é¢˜ç”Ÿæˆ...', 'info');
            
            const testContent = 'ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œé˜³å…‰æ˜åªšï¼Œé€‚åˆå¤–å‡ºæ¸¸ç©ã€‚';
            
            try {
                const response = await fetch('/api/generate-titles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: testContent })
                });

                if (response.ok) {
                    const data = await response.json();
                    showResult('api-result', `âœ… ç®€å•ç”Ÿæˆæµ‹è¯•æˆåŠŸ\nå†…å®¹: ${testContent}\nç”Ÿæˆçš„æ ‡é¢˜:\n${data.titles.map((t, i) => `${i+1}. ${t.title}`).join('\n')}`, 'success');
                    addLog('ç®€å•æ ‡é¢˜ç”Ÿæˆæµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    const error = await response.text();
                    throw new Error(`HTTP ${response.status}: ${error}`);
                }
            } catch (error) {
                showResult('api-result', `âŒ ç®€å•ç”Ÿæˆæµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, 'error');
                addLog(`ç®€å•æ ‡é¢˜ç”Ÿæˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ–‡æœ¬å¤„ç†
        async function testTextProcessing() {
            addLog('æµ‹è¯•æ–‡æœ¬å¤„ç†åŠŸèƒ½...', 'info');
            
            const testText = 'è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬ï¼Œç”¨äºéªŒè¯æ–‡æœ¬å¤„ç†åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚';
            
            try {
                const response = await fetch('/api/generate-titles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: testText })
                });

                if (response.ok) {
                    showResult('content-result', `âœ… æ–‡æœ¬å¤„ç†æˆåŠŸ\nè¾“å…¥é•¿åº¦: ${testText.length} å­—ç¬¦\nå¤„ç†çŠ¶æ€: æ­£å¸¸`, 'success');
                    addLog('æ–‡æœ¬å¤„ç†æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult('content-result', `âŒ æ–‡æœ¬å¤„ç†å¤±è´¥\né”™è¯¯: ${error.message}`, 'error');
                addLog(`æ–‡æœ¬å¤„ç†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•URLæŠ“å–
        async function testUrlFetching() {
            const testUrl = document.getElementById('test-url').value;
            addLog(`æµ‹è¯•URLæŠ“å–: ${testUrl}`, 'info');
            
            try {
                const response = await fetch('/api/fetch-url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: testUrl })
                });

                if (response.ok) {
                    const data = await response.json();
                    showResult('content-result', `âœ… URLæŠ“å–æˆåŠŸ\nURL: ${testUrl}\nå†…å®¹é•¿åº¦: ${data.content.length} å­—ç¬¦\nå†…å®¹é¢„è§ˆ:\n${data.content.substring(0, 500)}...`, 'success');
                    addLog('URLæŠ“å–æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    const error = await response.text();
                    throw new Error(`HTTP ${response.status}: ${error}`);
                }
            } catch (error) {
                showResult('content-result', `âŒ URLæŠ“å–å¤±è´¥\nURL: ${testUrl}\né”™è¯¯: ${error.message}`, 'error');
                addLog(`URLæŠ“å–æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ ‡é¢˜ç”Ÿæˆ
        async function testTitleGeneration() {
            const content = document.getElementById('test-content').value;
            addLog('æµ‹è¯•å®Œæ•´æ ‡é¢˜ç”Ÿæˆ...', 'info');
            
            if (!content.trim()) {
                showResult('title-result', 'âŒ è¯·è¾“å…¥æµ‹è¯•å†…å®¹', 'error');
                return;
            }

            try {
                const response = await fetch('/api/generate-titles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content })
                });

                if (response.ok) {
                    const data = await response.json();
                    const titlesText = data.titles.map((title, i) => 
                        `${i+1}. ${title.title}\n   æ–¹æ³•: ${title.method}\n   åˆ†æ: ${title.analysis}\n`
                    ).join('\n');
                    
                    showResult('title-result', `âœ… æ ‡é¢˜ç”ŸæˆæˆåŠŸ\nç”Ÿæˆæ•°é‡: ${data.titles.length}ä¸ª\n\n${titlesText}`, 'success');
                    addLog(`æ ‡é¢˜ç”Ÿæˆæµ‹è¯•æˆåŠŸï¼Œç”Ÿæˆ${data.titles.length}ä¸ªæ ‡é¢˜`, 'success');
                } else {
                    const error = await response.text();
                    throw new Error(`HTTP ${response.status}: ${error}`);
                }
            } catch (error) {
                showResult('title-result', `âŒ æ ‡é¢˜ç”Ÿæˆå¤±è´¥\né”™è¯¯: ${error.message}`, 'error');
                addLog(`æ ‡é¢˜ç”Ÿæˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å¼€å§‹/åœæ­¢æ—¥å¿—ç›‘æ§
        function startLogMonitoring() {
            const btn = document.getElementById('log-btn');
            
            if (!logMonitoring) {
                logMonitoring = true;
                btn.textContent = 'åœæ­¢ç›‘æ§';
                addLog('å¼€å§‹æ—¥å¿—ç›‘æ§...', 'info');
                
                // æ¨¡æ‹Ÿæ—¥å¿—ç›‘æ§
                logInterval = setInterval(() => {
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ—¥å¿—è·å–é€»è¾‘
                    if (Math.random() > 0.7) {
                        addLog('ç³»ç»Ÿè¿è¡Œæ­£å¸¸', 'success');
                    }
                }, 3000);
            } else {
                logMonitoring = false;
                btn.textContent = 'å¼€å§‹ç›‘æ§';
                addLog('åœæ­¢æ—¥å¿—ç›‘æ§', 'warning');
                clearInterval(logInterval);
            }
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            addLog('æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        window.addEventListener('load', () => {
            checkServerHealth();
            addLog('è°ƒè¯•å·¥å…·å·²åŠ è½½', 'info');
        });
    </script>
</body>
</html>