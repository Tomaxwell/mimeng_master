# 🔧 迷蒙标题生成器 - 故障排除指南

## 🚀 快速诊断

### 1. 使用调试工具
访问 `http://localhost:3000/debug` 进行全面的系统检查。

### 2. 运行测试脚本
```bash
# API连接测试
node test-api.js

# 故障排除脚本
troubleshoot.bat  # Windows
```

---

## 🎯 常见问题及解决方案

### ❌ 问题1: 标题生成失败

**症状**: 点击"生成爆款标题"后显示"生成标题失败"

**可能原因及解决方案**:

#### A. DeepSeek API密钥问题
```bash
# 检查.env文件
cat .env

# 确保格式正确
DEEPSEEK_API_KEY=sk-your-actual-api-key
```

**解决方案**:
1. 访问 [DeepSeek平台](https://platform.deepseek.com/)
2. 检查API密钥是否有效
3. 确认账户余额充足
4. 重新生成API密钥

#### B. 模型名称错误
**已修复**: 将模型名称从 `deepseek-v3.1` 改为 `deepseek-chat`

#### C. 网络连接问题
```bash
# 测试网络连接
ping api.deepseek.com

# 检查防火墙设置
```

#### D. 内容长度不足
**错误**: 内容少于100字符
**解决**: 提供更多内容（建议200字符以上）

---

### ❌ 问题2: 服务器启动失败

**症状**: `npm start` 执行失败

#### A. 端口被占用
```bash
# 查看占用3000端口的进程
netstat -ano | findstr :3000

# 结束进程（替换PID）
taskkill /F /PID 12345

# 或使用不同端口
SET PORT=3001 && npm start
```

#### B. 依赖包问题
```bash
# 清理并重新安装
rm -rf node_modules
npm install

# 清理npm缓存
npm cache clean --force
```

#### C. 环境变量问题
```bash
# 检查.env文件是否存在
ls -la .env

# 检查环境变量
echo $DEEPSEEK_API_KEY
```

---

### ❌ 问题3: 文件上传失败

**症状**: 拖拽或选择文件后显示错误

#### A. 文件格式不支持
**支持格式**: PDF、Word(.doc/.docx)、TXT、Markdown(.md)
**文件大小限制**: 最大10MB

#### B. 文件损坏或加密
- 尝试不同的文件
- 确认PDF文件不是扫描版
- 检查Word文档是否可正常打开

#### C. 权限问题
```bash
# 确认uploads目录存在且可写
mkdir -p uploads
chmod 755 uploads
```

---

### ❌ 问题4: URL内容抓取失败

**症状**: 输入链接后无法获取内容

#### A. URL格式错误
- 确保URL以 http:// 或 https:// 开头
- 检查URL是否可直接访问

#### B. 网站防爬虫
- 某些网站有反爬虫机制
- 尝试其他新闻网站或博客
- 使用"直接输入"功能

#### C. 网络超时
- 检查网络连接
- 尝试访问速度快的网站

---

### ❌ 问题5: 前端页面无法加载

**症状**: 浏览器显示"无法访问"

#### A. 服务器未启动
```bash
# 检查服务器状态
curl http://localhost:3000/api/health

# 启动服务器
npm start
```

#### B. 端口配置错误
- 检查浏览器地址栏：`http://localhost:3000`
- 确认PORT环境变量设置

#### C. 防火墙阻止
- 检查Windows防火墙设置
- 允许Node.js通过防火墙

---

## 🔍 诊断步骤

### 步骤1: 基础检查
```bash
# 检查Node.js版本 (需要16+)
node --version

# 检查npm版本
npm --version

# 检查项目文件
ls -la
```

### 步骤2: 环境检查
```bash
# 检查环境变量
cat .env

# 测试API连接
node test-api.js
```

### 步骤3: 服务器检查
```bash
# 启动服务器（如果未启动）
npm start

# 测试健康检查
curl http://localhost:3000/api/health
```

### 步骤4: 功能测试
1. 访问主页：`http://localhost:3000`
2. 访问调试页面：`http://localhost:3000/debug`
3. 测试各项功能

---

## 📊 性能监控

### CPU和内存使用
```bash
# Windows
tasklist | findstr node

# 查看详细进程信息
wmic process where name="node.exe" get ProcessId,PageFileUsage,WorkingSetSize
```

### 网络连接
```bash
# 检查网络延迟
ping api.deepseek.com

# 检查端口连通性
telnet api.deepseek.com 443
```

### 日志分析
```bash
# 查看实时日志（如果使用PM2或其他进程管理器）
pm2 logs

# 或查看控制台输出
```

---

## 🛠️ 高级故障排除

### 1. 清除所有缓存
```bash
# NPM缓存
npm cache clean --force

# 删除node_modules
rm -rf node_modules package-lock.json
npm install
```

### 2. 重置项目配置
```bash
# 备份.env文件
cp .env .env.backup

# 重新配置
cp .env.example .env
# 编辑.env添加API密钥
```

### 3. 检查系统资源
- 硬盘空间是否充足
- 内存使用是否过高
- CPU使用率是否正常

### 4. 网络诊断
```bash
# DNS解析测试
nslookup api.deepseek.com

# 路由追踪
tracert api.deepseek.com

# 防火墙测试
telnet api.deepseek.com 443
```

---

## 📞 寻求帮助

### 收集诊断信息
```bash
# 系统信息
systeminfo  # Windows

# Node.js环境
node --version
npm --version

# 项目依赖
npm list

# 错误日志
# 复制控制台的完整错误信息
```

### 常用调试命令
```bash
# 详细启动信息
npm start --verbose

# 调试模式
node --inspect server.js

# 环境变量调试
set DEBUG=* && npm start  # Windows
```

---

## ✅ 成功验证

确认以下所有项目都正常工作：

- [ ] 服务器启动成功
- [ ] 健康检查API响应正常
- [ ] DeepSeek API连接成功
- [ ] 文件上传功能正常
- [ ] URL抓取功能正常  
- [ ] 标题生成功能正常
- [ ] 前端界面显示正常

---

## 💡 预防措施

1. **定期备份**：备份.env文件和重要配置
2. **监控API使用量**：避免超出免费额度
3. **更新依赖**：定期更新npm包
4. **日志记录**：启用详细日志记录
5. **性能监控**：监控服务器资源使用情况

---

**如果以上方案都无法解决问题，请提供详细的错误信息和系统环境信息以获得进一步帮助。**